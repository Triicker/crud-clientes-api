<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sistema de AutenticaÃ§Ã£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f4f8;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Teste do Sistema de AutenticaÃ§Ã£o</h1>
        
        <div id="results"></div>
        
        <h3>Testes DisponÃ­veis:</h3>
        <button class="test-button" onclick="testAuthManager()">Testar Auth Manager</button>
        <button class="test-button" onclick="testUsers()">Testar UsuÃ¡rios</button>
        <button class="test-button" onclick="testPermissions()">Testar PermissÃµes</button>
        <button class="test-button" onclick="testLogin()">Testar Login</button>
        <button class="test-button" onclick="runAllTests()">ğŸš€ Executar Todos</button>
        
        <hr style="margin: 30px 0;">
        
        <h3>Acesso ao Sistema:</h3>
        <button class="test-button" onclick="window.open('login.html', '_blank')">
            ğŸ” Abrir Tela de Login
        </button>
        <button class="test-button" onclick="window.open('demo.html', '_blank')">
            ğŸ“‹ Abrir DemonstraÃ§Ã£o
        </button>
    </div>

    <!-- Scripts do sistema -->
    <script src="auth-manager.js"></script>
    
    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        function testAuthManager() {
            clearResults();
            addResult('ğŸ§ª Testando Auth Manager...', 'info');
            
            try {
                if (typeof authManager === 'undefined') {
                    addResult('âŒ Auth Manager nÃ£o encontrado!', 'error');
                    return;
                }
                
                addResult('âœ… Auth Manager carregado com sucesso', 'success');
                
                // Testar se nÃ£o estÃ¡ logado inicialmente
                if (!authManager.isAuthenticated()) {
                    addResult('âœ… Sistema iniciado sem autenticaÃ§Ã£o (correto)', 'success');
                } else {
                    addResult('âš ï¸ Sistema jÃ¡ possui usuÃ¡rio logado', 'info');
                    const user = authManager.getCurrentUser();
                    addResult(`UsuÃ¡rio atual: ${user.name} (${user.email})`, 'info');
                }
                
            } catch (error) {
                addResult(`âŒ Erro no Auth Manager: ${error.message}`, 'error');
            }
        }
        
        function testUsers() {
            clearResults();
            addResult('ğŸ§ª Testando Base de UsuÃ¡rios...', 'info');
            
            try {
                const users = authManager.users;
                addResult(`âœ… ${users.length} usuÃ¡rios carregados`, 'success');
                
                // Contar por departamento
                const departments = {};
                users.forEach(user => {
                    departments[user.department] = (departments[user.department] || 0) + 1;
                });
                
                Object.entries(departments).forEach(([dept, count]) => {
                    addResult(`ğŸ“Š ${dept}: ${count} usuÃ¡rios`, 'info');
                });
                
                // Testar nÃ­veis de acesso
                const levels = {};
                users.forEach(user => {
                    levels[user.accessLevel] = (levels[user.accessLevel] || 0) + 1;
                });
                
                Object.entries(levels).sort().forEach(([level, count]) => {
                    const levelName = {5: 'Admin', 4: 'Diretor', 3: 'Gerente', 2: 'Consultor', 1: 'UsuÃ¡rio'}[level];
                    addResult(`ğŸ¯ NÃ­vel ${level} (${levelName}): ${count} usuÃ¡rios`, 'info');
                });
                
            } catch (error) {
                addResult(`âŒ Erro nos usuÃ¡rios: ${error.message}`, 'error');
            }
        }
        
        function testPermissions() {
            clearResults();
            addResult('ğŸ§ª Testando Sistema de PermissÃµes...', 'info');
            
            try {
                // Testar permissÃµes sem login
                const permissions = authManager.getUserPermissions();
                const permCount = Object.values(permissions).filter(p => p === true).length;
                
                if (permCount === 0) {
                    addResult('âœ… UsuÃ¡rio sem login: 0 permissÃµes (correto)', 'success');
                } else {
                    addResult(`âš ï¸ UsuÃ¡rio sem login tem ${permCount} permissÃµes`, 'error');
                }
                
                // Testar permissÃµes de cada nÃ­vel
                const testUser = authManager.users.find(u => u.accessLevel === 5); // Admin
                if (testUser) {
                    authManager.currentUser = testUser;
                    authManager.isLoggedIn = true;
                    
                    const adminPerms = authManager.getUserPermissions();
                    const adminPermCount = Object.values(adminPerms).filter(p => p === true).length;
                    
                    addResult(`âœ… Admin tem ${adminPermCount} permissÃµes`, 'success');
                    
                    // Limpar
                    authManager.currentUser = null;
                    authManager.isLoggedIn = false;
                }
                
            } catch (error) {
                addResult(`âŒ Erro nas permissÃµes: ${error.message}`, 'error');
            }
        }
        
        function testLogin() {
            clearResults();
            addResult('ğŸ§ª Testando Processo de Login...', 'info');
            
            try {
                // Testar login invÃ¡lido
                try {
                    authManager.login('invalid@email.com', 'wrongpass');
                    addResult('âŒ Login invÃ¡lido deveria falhar!', 'error');
                } catch (e) {
                    addResult('âœ… Login invÃ¡lido rejeitado corretamente', 'success');
                }
                
                // Testar login vÃ¡lido
                try {
                    const user = authManager.login('admin@empresa.com', 'admin123');
                    addResult(`âœ… Login vÃ¡lido aceito: ${user.name}`, 'success');
                    
                    // Testar se estÃ¡ autenticado
                    if (authManager.isAuthenticated()) {
                        addResult('âœ… Estado de autenticaÃ§Ã£o correto', 'success');
                    } else {
                        addResult('âŒ Estado de autenticaÃ§Ã£o incorreto', 'error');
                    }
                    
                    // Testar logout
                    authManager.logout();
                    if (!authManager.isAuthenticated()) {
                        addResult('âœ… Logout funcionou corretamente', 'success');
                    } else {
                        addResult('âŒ Logout nÃ£o funcionou', 'error');
                    }
                    
                } catch (e) {
                    addResult(`âŒ Login vÃ¡lido falhou: ${e.message}`, 'error');
                }
                
            } catch (error) {
                addResult(`âŒ Erro no teste de login: ${error.message}`, 'error');
            }
        }
        
        function runAllTests() {
            clearResults();
            addResult('ğŸš€ Executando todos os testes...', 'info');
            
            setTimeout(() => {
                testAuthManager();
                setTimeout(() => {
                    testUsers();
                    setTimeout(() => {
                        testPermissions();
                        setTimeout(() => {
                            testLogin();
                            addResult('ğŸ‰ Todos os testes concluÃ­dos!', 'success');
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }
        
        // Executar teste bÃ¡sico ao carregar
        document.addEventListener('DOMContentLoaded', () => {
            addResult('ğŸ”§ Sistema de teste carregado. Clique em um botÃ£o para testar.', 'info');
        });
    </script>
</body>
</html>